From fba29ccf278e314eae5b5393ca4282eb4bc60623 Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Thu, 7 Sep 2017 17:32:59 +0000
Subject: [PATCH] Add LuneOS specific switches

* Disable some sandbox capabilities, which are incompatible with our (old) kernels
* Disable OpenGL ES 3, as Qt's shared context uses OpenGL ES 2
* Enable flash/widevine plugins
---
 src/core/web_engine_context.cpp | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/src/core/web_engine_context.cpp b/src/core/web_engine_context.cpp
index 99d0e38..dd44799 100644
--- a/src/core/web_engine_context.cpp
+++ b/src/core/web_engine_context.cpp
@@ -347,6 +347,17 @@ WebEngineContext::WebEngineContext()
 
     // The Mojo local-storage is currently pretty broken and saves in $$PWD/Local\ Storage
     parsedCommandLine->AppendSwitch(switches::kDisableMojoLocalStorage);
+    //// LuneOS specific
+    // Disable some sandbox capabilities, which are incompatible with our (old) kernels
+    parsedCommandLine->AppendSwitch(switches::kDisableNamespaceSandbox);
+    parsedCommandLine->AppendSwitch(switches::kDisableSeccompFilterSandbox);
+    // Disable OpenGL ES 3, as Qt's shared context uses OpenGL ES 2
+    parsedCommandLine->AppendSwitch(switches::kDisableES3GLContext);
+    // Add switches to enable flash/widevine plugins
+    parsedCommandLine->AppendSwitchASCII("ppapi-flash-path", "/usr/lib/chromium/libpepflashplayer.so");
+    parsedCommandLine->AppendSwitchASCII("ppapi-flash-version", "26.0.0.151");
+    parsedCommandLine->AppendSwitchASCII(switches::kRegisterPepperPlugins, "/usr/lib/chromium/libwidevinecdmadapter.so;application/x-ppapi-widevine-cdm");
+    //// End of LuneOS specific
 
     // Shared workers are not safe until Chromium 64
     parsedCommandLine->AppendSwitch(switches::kDisableSharedWorkers);
