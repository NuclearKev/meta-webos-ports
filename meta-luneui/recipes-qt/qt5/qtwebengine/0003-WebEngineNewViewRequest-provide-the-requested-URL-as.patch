From 972944390be335daac36b9a48dafb38605c5662f Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Mon, 28 Sep 2015 20:19:49 +0200
Subject: [PATCH 03/14] WebEngineNewViewRequest: provide the requested URL as a
 property

Signed-off-by: Christophe Chapuis <chris.chapuis@gmail.com>
---
 src/webengine/api/qquickwebenginenewviewrequest.cpp | 8 ++++++++
 src/webengine/api/qquickwebenginenewviewrequest_p.h | 2 ++
 2 files changed, 10 insertions(+)

diff --git a/src/webengine/api/qquickwebenginenewviewrequest.cpp b/src/webengine/api/qquickwebenginenewviewrequest.cpp
index 1ae4bfa..3be46a9 100644
--- a/src/webengine/api/qquickwebenginenewviewrequest.cpp
+++ b/src/webengine/api/qquickwebenginenewviewrequest.cpp
@@ -87,6 +87,14 @@ const QStringList &QQuickWebEngineNewViewRequest::additionalFeatures() const
     return m_additionalFeatures;
 }
 
+QUrl QQuickWebEngineNewViewRequest::url() const
+{
+    if (!m_adapter) {
+        return m_adapter->activeUrl();
+    }
+    return QUrl();
+}
+
 /*!
     \qmlmethod WebEngineNewViewRequest::openIn(WebEngineView view)
 
diff --git a/src/webengine/api/qquickwebenginenewviewrequest_p.h b/src/webengine/api/qquickwebenginenewviewrequest_p.h
index 4f208f2..92626cc 100644
--- a/src/webengine/api/qquickwebenginenewviewrequest_p.h
+++ b/src/webengine/api/qquickwebenginenewviewrequest_p.h
@@ -67,6 +67,7 @@ class Q_WEBENGINE_PRIVATE_EXPORT QQuickWebEngineNewViewRequest : public QObject
     Q_PROPERTY(QQuickWebEngineView::NewViewDestination destination READ destination CONSTANT FINAL)
     Q_PROPERTY(bool userInitiated READ isUserInitiated CONSTANT FINAL)
     Q_PROPERTY(QStringList additionalFeatures READ additionalFeatures CONSTANT FINAL)
+    Q_PROPERTY(QUrl url READ url)
 public:
     ~QQuickWebEngineNewViewRequest();
 
@@ -74,6 +75,7 @@ public:
     bool isUserInitiated() const;
     const QStringList &additionalFeatures() const;
     Q_INVOKABLE void openIn(QQuickWebEngineView *view);
+    QUrl url() const;
 
 private:
     QQuickWebEngineNewViewRequest();
-- 
2.7.4

