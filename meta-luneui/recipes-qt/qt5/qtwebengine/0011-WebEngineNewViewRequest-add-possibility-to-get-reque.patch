From 7f423037ad77b148e3f0c4d8fc8aada1a432466f Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Wed, 28 Oct 2015 20:17:02 +0100
Subject: [PATCH 11/14] WebEngineNewViewRequest: add possibility to get
 requested window geometry

Signed-off-by: Christophe Chapuis <chris.chapuis@gmail.com>
---
 src/webengine/api/qquickwebenginenewviewrequest.cpp | 5 +++++
 src/webengine/api/qquickwebenginenewviewrequest_p.h | 5 ++++-
 src/webengine/api/qquickwebengineview.cpp           | 3 ++-
 3 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/src/webengine/api/qquickwebenginenewviewrequest.cpp b/src/webengine/api/qquickwebenginenewviewrequest.cpp
index 6477654..ffd622f 100644
--- a/src/webengine/api/qquickwebenginenewviewrequest.cpp
+++ b/src/webengine/api/qquickwebenginenewviewrequest.cpp
@@ -95,6 +95,11 @@ QUrl QQuickWebEngineNewViewRequest::url() const
     return QUrl();
 }
 
+QRect QQuickWebEngineNewViewRequest::requestedGeometry() const
+{
+    return m_requestedGeometry;
+}
+
 /*!
     \qmlmethod WebEngineNewViewRequest::openIn(WebEngineView view)
 
diff --git a/src/webengine/api/qquickwebenginenewviewrequest_p.h b/src/webengine/api/qquickwebenginenewviewrequest_p.h
index 92626cc..60256fe 100644
--- a/src/webengine/api/qquickwebenginenewviewrequest_p.h
+++ b/src/webengine/api/qquickwebenginenewviewrequest_p.h
@@ -67,7 +67,8 @@ class Q_WEBENGINE_PRIVATE_EXPORT QQuickWebEngineNewViewRequest : public QObject
     Q_PROPERTY(QQuickWebEngineView::NewViewDestination destination READ destination CONSTANT FINAL)
     Q_PROPERTY(bool userInitiated READ isUserInitiated CONSTANT FINAL)
     Q_PROPERTY(QStringList additionalFeatures READ additionalFeatures CONSTANT FINAL)
-    Q_PROPERTY(QUrl url READ url)
+    Q_PROPERTY(QUrl url READ url CONSTANT FINAL)
+    Q_PROPERTY(QRect requestedGeometry READ requestedGeometry CONSTANT FINAL)
 public:
     ~QQuickWebEngineNewViewRequest();
 
@@ -76,6 +77,7 @@ public:
     const QStringList &additionalFeatures() const;
     Q_INVOKABLE void openIn(QQuickWebEngineView *view);
     QUrl url() const;
+    QRect requestedGeometry() const;
 
 private:
     QQuickWebEngineNewViewRequest();
@@ -84,6 +86,7 @@ private:
     QSharedPointer<QtWebEngineCore::WebContentsAdapter> m_adapter;
     QUrl m_requestedUrl;
     friend class QQuickWebEngineView;
+    QRect m_requestedGeometry;
     QStringList m_additionalFeatures;
     friend class QQuickWebEngineViewPrivate;
 };
diff --git a/src/webengine/api/qquickwebengineview.cpp b/src/webengine/api/qquickwebengineview.cpp
index 4a5f1d8..9eccf7c 100644
--- a/src/webengine/api/qquickwebengineview.cpp
+++ b/src/webengine/api/qquickwebengineview.cpp
@@ -587,7 +587,7 @@ void QQuickWebEngineViewPrivate::unhandledKeyEvent(QKeyEvent *event)
         q->window()->sendEvent(q->parentItem(), event);
 }
 
-void QQuickWebEngineViewPrivate::adoptNewWindow(QSharedPointer<WebContentsAdapter> newWebContents, WindowOpenDisposition disposition, bool userGesture, const QRect &, const QStringList &additionalFeaturesStringList)
+void QQuickWebEngineViewPrivate::adoptNewWindow(QSharedPointer<WebContentsAdapter> newWebContents, WindowOpenDisposition disposition, bool userGesture, const QRect &requestedGeometry, const QStringList &additionalFeaturesStringList)
 {
     Q_Q(QQuickWebEngineView);
     QQuickWebEngineNewViewRequest request;
@@ -596,6 +596,7 @@ void QQuickWebEngineViewPrivate::adoptNewWindow(QSharedPointer<WebContentsAdapte
     request.m_adapter = newWebContents;
     request.m_isUserInitiated = userGesture;
     request.m_additionalFeatures = additionalFeaturesStringList;
+    request.m_requestedGeometry = requestedGeometry;
 
     switch (disposition) {
     case WebContentsAdapterClient::NewForegroundTabDisposition:
-- 
2.7.4

