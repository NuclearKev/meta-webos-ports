From b48976111dc78022e4100358b4fe698522e03332 Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Sat, 22 Jul 2017 07:16:31 +0000
Subject: [PATCH] setKeyboardFocus: fix crash when surface is NULL

---
 src/compositor/compositor_api/qwaylandseat.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/compositor/compositor_api/qwaylandseat.cpp b/src/compositor/compositor_api/qwaylandseat.cpp
index f6a5276..0b901f5 100644
--- a/src/compositor/compositor_api/qwaylandseat.cpp
+++ b/src/compositor/compositor_api/qwaylandseat.cpp
@@ -375,7 +375,7 @@ bool QWaylandSeat::setKeyboardFocus(QWaylandSurface *surface)
     d->keyboardFocus = surface;
     if (!d->keyboard.isNull())
         d->keyboard->setFocus(surface);
-    if (d->data_device)
+    if (d->data_device && surface)
         d->data_device->setFocus(surface->client());
     emit keyboardFocusChanged(surface, oldSurface);
     return true;
-- 
2.7.4

